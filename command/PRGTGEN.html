

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>PRGTGEN &mdash; GOR Open Source v.2.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/gorpipe.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <nav class="wy-master-nav">
    <div class="gor-logo-home">
        <a href="../index.html">
            <img src="../_static/GORLogoText.svg" class="logo" />
        </a>
    </div>
    <div role="search" class="wxnc-search-form">
        <button class="wxnc-search-button" form="wxnc-search-form" formmethod="get">
            <i class="fa fa-search" aria-hidden="true"> </i>
        </button>
        <form id="wxnc-search-form" class="wy-form" action="../search.html" method="get">
            <input class="wxnc-no-right-border" size="30" type="text" name="q" placeholder="Search the user manual..."/>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>
    </div>
</nav>

  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            
            
              <div class="version">
                <a href="../index.html">
                  GOR Open Source
                  <p class="wxnc-subtitle">Documentation</p>
                </a>
              </div>
            
          

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">Functions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GOR Open Source</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>PRGTGEN</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <span style="float:right; padding-top:10px; color:#BABABA;">Used in: gor only</span><div class="section" id="prgtgen">
<span id="id1"></span><h1>PRGTGEN<a class="headerlink" href="#prgtgen" title="Permalink to this headline">¶</a></h1>
<p>The <strong>PRGTGEN</strong> command is a probabilistic version of <strong>GTGEN</strong>, i.e. it does the same but also does a simple joint
variant calling and returns the genotypes in probabilistic form.</p>
<p>The incoming stream is a gor stream containing genotypes, one pn per line. The genotypes can come in the following:
i) Probabilistic: A triplet containing the probabilities of Ref-Ref, Ref-Alt, Alt-Alt. Can either be stored in a column
named GP, in Phred scale in a column named PL or in logarithmic scale in a column named GL.
ii) Raw: Then there should be one column called ‘depth’ containing the reading depth and another named ‘callratio’
containing the call ratio.</p>
<p>As input, there should be one tag-bucket source, a coverage source and optionally a gor source containing prior allele
frequencies estimates and the number of samples behind that estimate.</p>
<p>The coverage file should contain segments, a depth column and a pn column.</p>
<p>The gor source containing the allele frequencies and the number of samples behind the estimates, should contain an AF
column with the allele frequencies and an AN column with the number of samples. It should be interpreted as follows:
The tag list from the tag-bucket file is thought of as coming from a larger collection of pns and the allele frequency
given in the source should be thought of as having been estimated for some number of samples from the cohort, excluding
the ones we are calling now.</p>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span><span class="nd">gor</span> ... | PRGTGEN tagbucketrelation [optional: prior_gor_source] coverage_gor_source [ attributes ]
</pre></div>
</div>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-gc</span> <span class="pre">cols</span></code></p></td>
<td><p>Grouping columns other than (chrom,pos)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-prgc</span> <span class="pre">cols</span></code></p></td>
<td><p>Grouping columns for prior input other than (chrom,pos)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-pn</span> <span class="pre">pnColName</span></code></p></td>
<td><p>Override the default PN colunm name used to represent the tag value.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-maxseg</span> <span class="pre">bpsize</span></code></p></td>
<td><p>The maximum span size of the coverage segments.  Defaults to 10000 (10kb).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">error</span> <span class="pre">rate</span></code></p></td>
<td><p>The error rate of the reads.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-fpab</span> <span class="pre">prior</span></code></p></td>
<td><p>The prior assumed to have been used when prob likelihoods (PL) are used.  Use 0.33 for flat prior.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-fpbb</span> <span class="pre">prior</span></code></p></td>
<td><p>The prior for the alternative homozygot.  Use fpab = fpbb = 0.333 for flat prior.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-maxit</span> <span class="pre">mi</span></code></p></td>
<td><p>The maximum number of iterations. Default value is 20.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-tol</span> <span class="pre">tolerance</span></code></p></td>
<td><p>The tolerance. Default value is 1e-5.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-gp</span> <span class="pre">col</span></code></p></td>
<td><p>The GP col (from i)). Is looked up by name if not given.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-pl</span> <span class="pre">col</span></code></p></td>
<td><p>The PL col (from i)). Is looked up by name if not given.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-gl</span> <span class="pre">col</span></code></p></td>
<td><p>The GL col (from i)). Is looked up by name if not given.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-pabc</span> <span class="pre">col</span></code></p></td>
<td><p>The probability for heterozygot genotype pAB=2pq</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-pbbc</span> <span class="pre">col</span></code></p></td>
<td><p>The probability for homozygot alt, pBB = pAltAlt, equal to Af*Af if variant in HWE</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-anc</span> <span class="pre">col</span></code></p></td>
<td><p>The allele number column in the prior source. Is looked up by name if not given.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-cc</span> <span class="pre">col</span></code></p></td>
<td><p>The call copies column from ii) Looked up by name if not given.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-crc</span> <span class="pre">col</span></code></p></td>
<td><p>The call ratio column from iii) Looked up by name if not given.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-ld</span> <span class="pre">col</span></code></p></td>
<td><p>The depth column from the incoming source in ii). Looked up by name if not given.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-rd</span> <span class="pre">col</span></code></p></td>
<td><p>The depth column from the prior source. Lookup up by name if not given.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-th</span> <span class="pre">threshold</span></code></p></td>
<td><p>The threshold to use, if the genotypes should be written out as discrete genotypes. Giving the
threshold indicates that the hard calls should be written out.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-psep</span> <span class="pre">separator</span></code></p></td>
<td><p>The separator in the probability triplet. Default value is ‘;’. Must be a single character.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-osep</span> <span class="pre">separator</span></code></p></td>
<td><p>The separator to separate the genotypes, in case the triplets should we written out.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-combgt</span></code></p></td>
<td><p>Try to combine the het and alt-hom probabilities if no genotype exceeds threshold.  The genotype
corresponding to the one with larger probability is used, i.e. het or hom-alt.  This is to save
genotypes that are between het/hom-alt state from being called unknown.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span>/* An example simulating genotypes and comparing incremental joint-calling with single step join-calling */

<span class="nd">def</span> #r# = rename #1 <span class="na">PN</span> | replace #1 #1+1;
<span class="nd">def</span> #n# = 999;
<span class="nd">def</span> #bucksize# = 500;

<span class="nd">create</span> #bucket# = norrows #n# | #r# | rownum | calc bucket &#39;b&#39;+<span class="k">str</span>(1+div(rownum, #bucksize# )) | hide rownum;
<span class="nd">create</span> #pns# = <span class="nd">nor</span> [#bucket#] | select pn;

<span class="nd">create</span> #cov# = <span class="nd">gor</span> &lt;(<span class="nd">nor</span> [#pns#] | calc chrom &#39;chr1&#39; | calc bpstart 0 | calc bpstop 10 | calc depth 10
| select chrom-depth,pn);

<span class="nd">create</span> #vars# = <span class="nd">gor</span> &lt;(<span class="nd">nor</span> [#pns#] | calc chrom &#39;chr1&#39; | calc <span class="na">pos</span> 10 | calc ref &#39;A&#39; | calc <span class="na">alt</span> &#39;C&#39;
| calc CallCopies if(random()&lt;0.01 or pn &gt; &#39;950&#39; and random()&lt;0.55 or pn = &#39;999&#39; /* or pn = &#39;1&#39; */,1,0)
| calc Depth 10
| calc CallRatio form(if(pn=&#39;999&#39; /* or pn=&#39;1&#39; */,1.0,if(callcopies=1, round(Depth/2.0)+round(Depth*0.9*(-0.5+random())), round(-1+random()+random()+random()) )/Depth),4,4)
| select chrom-callratio,pn)
| where callratio&gt;0;

<span class="nd">create</span> #pns1# = <span class="nd">nor</span> [#pns#] | top 950;
<span class="nd">create</span> #bucket1# = <span class="nd">nor</span> [#bucket#] | inset -c pn [#pns1#];

<span class="nd">create</span> #pns2# = <span class="nd">nor</span> [#pns#] | skip 950;
<span class="nd">create</span> #bucket2# = <span class="nd">nor</span> [#bucket#] | inset -c pn [#pns2#];

<span class="nd">def</span> #prthr# = 0.9;
<span class="nd">def</span> #e# = 0.001;
<span class="nd">def</span> #skip# = skip -5;

<span class="nd">create</span> #gt# = <span class="nd">gor</span> [#vars#] | #skip#
| inset -c pn [#pns#]
| prgtgen -<span class="no">gc</span> ref,<span class="na">alt</span> [#bucket#] [#cov#] -e #e#
| csvsel -<span class="no">gc</span> 3,4,af,an,pab,pbb -vs 2 [#bucket#] [#pns#]  -tag pn
| calc pr chars2prprpr(value)
| calc value2 chars2gt(value,#prthr#);

<span class="nd">create</span> #gt1# = <span class="nd">gor</span> [#vars#] | #skip#
| inset -c pn [#pns1#]
| prgtgen -<span class="no">gc</span> ref,<span class="na">alt</span> [#bucket1#] &lt;(<span class="nd">gor</span> [#cov#] | inset -c <span class="na">PN</span> [#pns1#]) -e  #e#
| csvsel -<span class="no">gc</span> 3,4,af,an,pab,pbb -vs 2 [#bucket1#] [#pns1#]  -tag pn
| calc pr chars2prprpr(value)
| calc value2 chars2gt(value,#prthr#);

<span class="nd">create</span> #gt2# = <span class="nd">gor</span> [#vars#] | #skip#
| inset -c pn [#pns2#]
| prgtgen -<span class="no">gc</span> ref,<span class="na">alt</span> [#bucket2#] &lt;(<span class="nd">gor</span> [#cov#] | inset -c <span class="na">PN</span> [#pns2#]) -e  #e#
| csvsel -<span class="no">gc</span> 3,4,af,an,pab,pbb -vs 2 [#bucket2#] [#pns2#]  -tag pn
| calc pr chars2prprpr(value)
| calc value2 chars2gt(value,#prthr#);

<span class="nd">create</span> #af1# = <span class="nd">gor</span> [#gt1#] | select 1-pbb | top 1 /* | replace pbb pbb+(1/AN)*(1/AN) */;

<span class="nd">create</span> #gt2af# = <span class="nd">gor</span> [#vars#] | #skip#
| inset -c pn [#pns2#]
| prgtgen -<span class="no">gc</span> ref,<span class="na">alt</span> [#bucket2#] [#af1#] &lt;(<span class="nd">gor</span> [#cov#] | inset -c <span class="na">PN</span> [#pns2#]) -e #e#
| where len(values)&gt;1
| csvsel -<span class="no">gc</span> 3,4,af,an,pab,pbb -vs 2 [#bucket2#] [#pns2#]  -tag pn
| calc pr chars2prprpr(value)
| calc value2 chars2gt(value,#prthr#);

/*
<span class="nd">gor</span> [#gt2af#] | varjoin -r -xl pn -xr pn [#gt2#] | varjoin -r -xl pn -xr pn [#gt#] | varjoin -r [ #vars#] -xl pn -xr pn
| where callcopies = -1 or value2xx = 2 | hide pn,pnx,pnxx,ref,<span class="na">alt</span>| colnum
*/

<span class="nd">gor</span> [#gt2af#] | varjoin -r -xl pn -xr pn [#gt2#] | varjoin -r -xl pn -xr pn [#gt#]
| calc err_gt2af if(value2!=value2xx,1,0) | calc err_gt2 if(value2x!=value2xx,1,0)
| group 1 -<span class="no">gc</span> an,af,anx,afx,anxx,afxx,value2xx,value2,value2x -sum -<span class="no">ic</span> err* -<span class="no">count</span>
</pre></div>
</div>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span>/* An example showing how to inspect in impact of the priors -fpab 0.01 -fpbb 0.001 by looking at the genotypes */
/* Note that option -combgt does not impact the prob-triplet chars2prprpr(value) */

<span class="nd">gor</span> [#vars#] | inset -c pn &lt;(<span class="nd">nor</span> [#bucket#] | top 8)
| replace depth if(pn=1,4,8)
| replace callratio if(pn=1,0.25,0.2)
| hide callcopies
| calc gp &#39;0.4;0.2;0.2&#39;
| hide callratio,depth
| prgtgen -fpab 0.01 -fpbb 0.001  -<span class="no">gc</span> ref,<span class="na">alt</span> &lt;(<span class="nd">nor</span> [#bucket#] | top 8)
  &lt;(<span class="nd">gor</span> [#cov#] | replace depth if(pn=1,6,8) | inset -c pn &lt;(<span class="nd">nor</span> [#bucket#] | top 8) )  -e 0.00001
| csvsel -<span class="no">gc</span> 3,4,af,an,pab,pbb -vs 2 &lt;(<span class="nd">nor</span> [#bucket#] | top 8) &lt;(<span class="nd">nor</span> [#bucket#] | top 8| select pn)  -tag pn
| calc pr chars2prprpr(value)
| calc value2 chars2gt(value,#prthr#)
</pre></div>
</div>
<div class="section" id="related-commands">
<h3>Related commands<a class="headerlink" href="#related-commands" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="CSVCC.html#csvcc"><span class="std std-ref">CSVCC</span></a> <a class="reference internal" href="CSVSEL.html#csvsel"><span class="std std-ref">CSVSEL</span></a> <a class="reference internal" href="GTLD.html#gtld"><span class="std std-ref">GTLD</span></a> <a class="reference internal" href="GTGEN.html#gtgen"><span class="std std-ref">GTGEN</span></a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020 GOR Open Source Project

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>