

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Pivoting &mdash; GOR Open Source v.2.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/gorpipe.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sequence Reads" href="sequenceReads.html" />
    <link rel="prev" title="Map and Multimap" href="mapMultimap.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <nav class="wy-master-nav">
    <div class="gor-logo-home">
        <a href="index.html">
            <img src="_static/GORLogoText.svg" class="logo" />
        </a>
    </div>
    <div role="search" class="wxnc-search-form">
        <button class="wxnc-search-button" form="wxnc-search-form" formmethod="get">
            <i class="fa fa-search" aria-hidden="true"> </i>
        </button>
        <form id="wxnc-search-form" class="wy-form" action="search.html" method="get">
            <input class="wxnc-no-right-border" size="30" type="text" name="q" placeholder="Search the user manual..."/>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>
    </div>
</nav>

  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            
            
              <div class="version">
                <a href="index.html">
                  GOR Open Source
                  <p class="wxnc-subtitle">Documentation</p>
                </a>
              </div>
            
          

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="introduction.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basicGORqueries.html">GOR and NOR</a></li>
<li class="toctree-l2"><a class="reference internal" href="filteringStreams.html">Filtering Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="columnModifications.html">Column Modifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="groupingAndAggregation.html">Grouping and Aggregation</a></li>
<li class="toctree-l2"><a class="reference internal" href="nestedStreams.html">Nested Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="joiningTables.html">Joining Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="mapMultimap.html">Map and Multimap</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Pivoting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#unpivoting-rows-in-gor">Unpivoting rows in GOR</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sequenceReads.html">Sequence Reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="variantData.html">Variation Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="materializedViews.html">Materialized Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallelGOR.html">Parallelization in GOR</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks.html">Using GOR in Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#what-is-gor">What is GOR?</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#writing-gor-queries">Writing GOR queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#reference-data">Reference Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions.html">Functions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GOR Open Source</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="introduction.html">Tutorials</a> &raquo;</li>
        
      <li>Pivoting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pivoting">
<h1>Pivoting<a class="headerlink" href="#pivoting" title="Permalink to this headline">Â¶</a></h1>
<p>In this chapter we will discuss how to pivot data in GOR queries. Loosely speaking, pivot commands in GOR perform a partial transpose operation. <a class="reference internal" href="command/PIVOT.html#pivot"><span class="std std-ref">PIVOT</span></a> turns rows into columns and <a class="reference internal" href="command/UNPIVOT.html#unpivot"><span class="std std-ref">UNPIVOT</span></a>  turns columns into rows.</p>
<p>More specifically, pivot aggregates rows and turns multiple rows into multiple columns on the same row. <a class="reference internal" href="command/PIVOT.html#pivot"><span class="std std-ref">PIVOT</span></a> is useful when we have the same item (defined by some composite key, such as <code class="docutils literal notranslate"><span class="pre">chrom+pos+reference+call</span></code> for variants) occurring multiple times with different values of the pivot column (such as <em>family role</em> values of father, mother, <a class="reference internal" href="glossary.html#term-proband"><span class="xref std std-term">proband</span></a> or sibling) and we want to use the value of that pivot column to control some other logic (such as considering the sequencing depth of the parent samples differently than we consider the sequencing depth of a proband sample).</p>
<p>Note that when we are pivoting a table, we need to know in advance what the possible values for the pivot column are. In the following example, we are first generating the data that we will use to pivot from the structure of the PNs and then pivoting on that generated data. For the purposes of this example, we are considering a set of samples, where the PN contains information about the family role that can be extracted using <strong>IF</strong> statements.</p>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span>     /* Example of <span class="nb">PIVOT</span> specifically for the Simons Foundation project */
<span class="nd">gor</span> #wesvars#
| select chrom,<span class="na">pos</span>,<span class="na">reference</span>,<span class="na">call</span>,depth,callcopies,<span class="na">PN</span>
| where <span class="na">PN</span> ~ &#39;TO2_12324.*&#39; | top 10
| calc family_role  /* <span class="k">IF</span>( predicate, IF_TRUE, <span class="k">IF</span>(...) )
   if (<span class="na">PN</span> ~ &#39;^.*FA$&#39;, &#39;FATHER&#39;,
   if (<span class="na">PN</span> ~ &#39;^.*MO$&#39;, &#39;MOTHER&#39;,
   if (<span class="na">PN</span> ~ &#39;^.*P.$&#39;, &#39;PROBAND&#39;,
   if (<span class="na">PN</span> ~ &#39;^.*S.$&#39;, &#39;SIBLING&#39;,
   &#39;UNKNOWN&#39;))))
| hide <span class="na">PN</span>
| pivot -<span class="no">gc</span> <span class="na">reference</span>,<span class="na">call</span> family_role -v FATHER,MOTHER,SIBLING,PROBAND -e 0
</pre></div>
</div>
<p>Because we are in a gor context, the chrom and pos columns are inherently in the composite key. To use an even more basic example, in the following query we are annotating variants with a random color label, aggregating the stream based on the variant data (reference and call) and the color label, and then using the label to pivot the data.</p>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span><span class="nd">gor</span> #wesvars# | top 10
| select chrom,<span class="na">pos</span>,<span class="na">reference</span>,<span class="na">call</span>
| calc label if(random()&lt;0.5,&#39;red&#39;,&#39;green&#39;)
| group 1 -<span class="no">gc</span> <span class="na">reference</span>,<span class="na">call</span>,label -<span class="no">count</span>
| pivot label -v red,green -<span class="no">gc</span> <span class="na">reference</span>,<span class="na">call</span> -e 0
</pre></div>
</div>
<p>This result will give us a unique row for each variant with two separate columns for the count of âredâ and âgreenâ labels for those variants. The images below show the stream of gor rows before and after the pivot.</p>
<div class="figure align-default" id="id1">
<a class="reference internal image-reference" href="_images/before_pivot.png"><img alt="_images/before_pivot.png" src="_images/before_pivot.png" style="width: 942.0px; height: 175.0px;" /></a>
<p class="caption"><span class="caption-text">The variants with color labels before pivoting</span><a class="headerlink" href="#id1" title="Permalink to this image">Â¶</a></p>
</div>
<div class="figure align-default" id="id2">
<a class="reference internal image-reference" href="_images/after_pivot.png"><img alt="_images/after_pivot.png" src="_images/after_pivot.png" style="width: 942.0px; height: 128.0px;" /></a>
<p class="caption"><span class="caption-text">The variants with color labels after pivoting</span><a class="headerlink" href="#id2" title="Permalink to this image">Â¶</a></p>
</div>
<div class="section" id="unpivoting-rows-in-gor">
<h2>Unpivoting rows in GOR<a class="headerlink" href="#unpivoting-rows-in-gor" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference internal" href="command/UNPIVOT.html#unpivot"><span class="std std-ref">UNPIVOT</span></a> takes a single row and breaks it into multiple rows, showing the name and value of the columns that were unpivoted. This can be useful when we have two groups of items (such as variants) and we want to understand exactly what attributes differ between the left and right sources. By unpivoting, we can then do a join and aggregation to identify attributes that were the same or to identify attributes that differed between the two tables.</p>
<p>The example below takes six columns from the <code class="docutils literal notranslate"><span class="pre">#wesvars#</span></code> table and separates the stream into separate rows for the callcopies and depth columns.</p>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span><span class="nd">gor</span> #wesvars#
| top 100
| select chrom,<span class="na">pos</span>,<span class="na">reference</span>,<span class="na">call</span>,callcopies,depth
| unpivot callcopies,depth
</pre></div>
</div>
<p>Youâll notice that if the input stream to the unpivot command has X number of rows, the output should have N*X number of rows, where N is the number of columns that got unpivoted.</p>
<p>In the following example, we are comparing two BAM files. Note that by unpivoting from column 4 and onwards and then joining on columns 1-3 and col_name, we are defining the composite key for both the unpivoting and also the joining to be the value of columns 1, 2 and 3. It is crucial to choose an appropriate composite key during these unpivot and join steps in order to achieve a meaningful result.</p>
<div class="highlight-gor notranslate"><div class="highlight"><pre><span></span><span class="nd">gor</span> bam1
| unpivot 4-
| join -n -<span class="no">snpsnp</span> -xl end,col_name -xr end,col_name &lt;(<span class="nd">gor</span> bam2 | unpivot 4-)
| calc label &quot;bam1&quot;
| merge &lt;(<span class="nd">gor</span> bam2 | unpivot 4-
| join -n -<span class="no">snpsnp</span> -xl end,col_name -xr end,col_name &lt;(<span class="nd">gor</span> bam1 | unpivot 4-
| calc label &quot;bam1&quot;)
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sequenceReads.html" class="btn btn-neutral float-right" title="Sequence Reads" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mapMultimap.html" class="btn btn-neutral float-left" title="Map and Multimap" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020 GOR Open Source Project

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>